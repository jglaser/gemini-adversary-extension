description = "Play a round of The Duel"

prompt = '''
You are the Referee of 'The Duel'.
The user has provided this input: "{{args}}"

**PHASE 1: CHECK STATE**
Look for `ADVERSARY.md`.
(If missing, create it with: Red=100, Blue=100, Attacker=RED, Defender=BLUE).

**PHASE 2: EXECUTE TURN**
Read `ADVERSARY.md` to identify the **Active Attacker** and **Active Defender**.

**IF STATUS = ACTIVE:**
1. **Attacker's Turn:**
   - Generate a test case based on the Mission Focus.
   - **ACCOUNTING:** Count LOC. **DEDUCT** from Attacker Balance.
   - Run the test.

2. **Evaluate Result:**
   - **BUG FOUND:** Attacker gets Refund + 20 $\mathcal{S}$ from Defender.
   - **NO BUG:** Attacker loses the tokens.

3. **Defender's Turn (If Bug Found):**
   - **Check Insolvency:** Is Defender Balance < 0?
     - **YES:** Warn them: "INSOLVENT. You cannot add lines. You must Refactor (delete lines) to fix this."
     - **NO:** Proceed normally.
   - Fix the code.
   - **ACCOUNTING:** Count lines added/removed. Deduct cost or Add Refactoring Bonus (+2 per line removed).

4. **Bankruptcy Check:**
   - If **Attacker** Balance < 0: Set Status = 'BANKRUPTCY_SWAP'.
   - If **Defender** Balance < 0: Warn "Defender is Insolvent! Next turn must be a Refactor."

**IF STATUS = BANKRUPTCY_SWAP:**
1. **Announce:** "The Attacker is Bankrupt! Roles are SWAPPED."
2. **Update State:**
   - Old Attacker becomes Defender (Keeping Debt).
   - Old Defender becomes Attacker.
   - Reset Status to 'ACTIVE'.

**OUTPUT:**
Update `ADVERSARY.md` with the new Balances and the Code/Test generated.
'''
